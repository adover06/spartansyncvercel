{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-6">
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-6 text-white">
        <h1 class="text-2xl font-bold">Welcome back, {{ current_user.username }}!</h1>
        <p class="text-indigo-100 mt-1">Here's what's happening in your courses.</p>
    </div>

    <div class="grid grid-cols-12 gap-6">
        <section class="col-span-12">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold">All Courses</h2>
                <a href="{{ url_for('main.manage_classes') }}" class="text-sm text-indigo-600 hover:underline">Manage enrollment</a>
            </div>
            <div class = "flex items-center justify-between mb-4">
                <section class ="col-span-12">

                    <h3 class="text-sm ">Don't Forget To Enroll! Click on Manage enrollment.</h3>

                </section>
           
            </div>
            {% if courses %}
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                    {% for course in courses %}
                        <a href="{{ course.link }}" class="block p-5 rounded-xl shadow-sm bg-white border-2 {% if course.is_enrolled %}border-indigo-500{% else %}border-gray-100{% endif %} hover:shadow-md transition-all">
                            {% if course.is_enrolled %}
                                <span class="inline-block text-xs px-2 py-1 rounded-full bg-indigo-100 text-indigo-700 mb-2">Enrolled</span>
                            {% endif %}
                            <p class="text-xs uppercase tracking-wide text-gray-500">{{ course.course_code }}</p>
                            <h3 class="text-lg font-semibold mt-1 text-gray-900">{{ course.title }}</h3>
                            <p class="text-sm text-gray-600 mt-2 line-clamp-2">{{ course.description or 'No description' }}</p>
                            {% if course.grade_info and course.grade_info.has_grades %}
                                <div class="mt-3 pt-3 border-t border-gray-100 flex items-center justify-between">
                                    <span class="text-xs text-gray-500">Grade:</span>
                                    <span class="text-xl font-bold {% if course.grade_info.grade >= 90 %}text-green-600{% elif course.grade_info.grade >= 80 %}text-blue-600{% elif course.grade_info.grade >= 70 %}text-yellow-600{% else %}text-red-600{% endif %}">
                                        {{ course.grade_info.grade }}%
                                    </span>
                                </div>
                            {% endif %}
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="bg-gray-50 rounded-xl p-8 text-center">
                    <p class="text-gray-500">No courses available yet.</p>
                    {% if current_user.role == 'instructor' %}
                        <a href="{{ url_for('main.course_create') }}" class="mt-2 inline-block text-indigo-600 hover:underline">Create the first course</a>
                    {% endif %}
                </div>
            {% endif %}
        </section>

        <section class="col-span-12 lg:col-span-8">
            <div class="bg-white rounded-xl shadow-sm p-5">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold">Upcoming Assignments</h3>
                    <a href="{{ url_for('main.assignment_list') }}" class="text-sm text-indigo-600 hover:underline">View all</a>
                </div>
                {% if assignments %}
                    <div class="divide-y divide-gray-100">
                        {% for a in assignments %}
                            <a href="{{ url_for('main.assignment_detail', assignment_id=a.id) }}" class="block py-4 hover:bg-gray-50 -mx-5 px-5 transition-colors">
                                <div class="flex items-start justify-between">
                                    <div>
                                        <h4 class="font-medium text-gray-900">{{ a.title }}</h4>
                                        <p class="text-sm text-gray-500">{{ a.course.course_name if a.course else 'General' }}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm text-gray-600">{{ a.due_date.strftime('%b %d') }}</p>
                                        <span class="text-xs px-2 py-1 rounded {{ a.progress_badge.class }}">{{ a.progress_badge.label }}</span>
                                    </div>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-500 py-4">No assignments yet.</p>
                {% endif %}
            </div>
        </section>

        <aside class="col-span-12 lg:col-span-4">
            <div class="bg-white rounded-xl shadow-sm p-5">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold">Announcements</h3>
                    <a href="{{ url_for('main.announcements') }}" class="text-sm text-indigo-600 hover:underline">View all</a>
                </div>
                {% if announcements %}
                    <div class="space-y-4">
                        {% for note in announcements %}
                            <a href="{{ url_for('main.announcement_detail', announcement_id=note.id) }}" class="block p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors">
                                <p class="text-xs text-gray-500">{{ note.created_at.strftime('%b %d') }} Â· {{ note.course.course_name if note.course else 'General' }}</p>
                                <h4 class="font-medium text-gray-900 mt-1">{{ note.title }}</h4>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-500">No announcements yet.</p>
                {% endif %}
            </div>
        </aside>
    </div>
</div>
{% endblock %}
