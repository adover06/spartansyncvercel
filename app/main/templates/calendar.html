{% extends 'base.html' %}

{% block content %}
<div class="flex items-center justify-between mb-4">
  <div>
    <h2 class="text-2xl font-semibold">Assignment Calendar</h2>
    <div class="text-sm text-gray-500">{{ month }}/{{ year }}</div>
  </div>
  <div class="flex items-center gap-3">
    <a class="inline-flex items-center gap-2 px-3 py-2 bg-gray-100 rounded hover:bg-gray-200 text-sm" href="{{ url_for('main.calendar_view', year=prev_month.year, month=prev_month.month) }}">← Prev</a>
    <a class="inline-flex items-center gap-2 px-3 py-2 bg-gray-100 rounded hover:bg-gray-200 text-sm" href="{{ url_for('main.calendar_view', year=next_month.year, month=next_month.month) }}">Next →</a>
    <a class="inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-500 text-sm" href="{{ url_for('main.calendar_export', year=year, month=month) }}">Export .ics</a>
  </div>
</div>

{% if course_map %}
<div class="mb-4 p-3 bg-white rounded shadow-sm">
  <div class="flex items-center gap-4">
    <div class="text-sm font-semibold">Legend:</div>
    <div class="flex flex-wrap gap-3">
      {% for cid, course in course_map.items() %}
        {% set color = course_colors.get(cid, '#3b82f6') %}
        <div class="flex items-center gap-2 text-sm">
          <span style="display:inline-block;width:14px;height:14px;border-radius:3px;background:{{ color }};box-shadow:0 0 0 1px rgba(0,0,0,0.03)" aria-hidden="true"></span>
          <span class="text-xs text-gray-700">{{ course.course_code }} — {{ course.course_name }}</span>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}

{% set weekday_names = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'] %}
<div class="bg-white rounded shadow-sm overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full table-fixed border-collapse">
      <thead class="bg-gray-50">
        <tr>
          {% for wd in weekday_names %}
          <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600">{{ wd }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for week in weeks %}
        <tr class="align-top">
          {% for day in week %}
          {% if not day %}
          <td class="h-36 border px-3 py-2 text-gray-300 bg-gray-50">&nbsp;</td>
          {% else %}
          <td class="h-36 border px-3 py-2 align-top bg-white hover:bg-gray-50">
            <div class="flex items-start justify-between">
              <div class="text-sm font-semibold">{{ day }}</div>
              <div class="text-xs text-gray-400">&nbsp;</div>
            </div>
            {% if events.get(day) %}
              <div class="mt-2 space-y-2">
                {% for ev in events.get(day) %}
                  {% set color = course_colors.get(ev.course.id) if ev.course else '#94a3b8' %}
                  <a href="{{ url_for('main.assignment_detail', assignment_id=ev.id) }}" class="block p-2 rounded-md shadow-sm hover:shadow-md bg-white" style="border-left:4px solid {{ color }};">
                    <div class="flex items-start justify-between gap-2">
                      <div class="flex-1 min-w-0">
                        <div class="text-sm font-medium truncate">{{ ev.title }}</div>
                        <div class="text-xs text-gray-500 mt-1">{{ ev.course.course_code if ev.course else 'General' }} • {{ ev.due_date.strftime('%H:%M') }}</div>
                      </div>
                      <div class="text-xs font-semibold text-gray-700">{{ ev.points }} pts</div>
                    </div>
                  </a>
                {% endfor %}
              </div>
            {% endif %}
          </td>
          {% endif %}
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
